---
# ZK-Communist Time Liberation Server - Configuration
# Non-sensitive configuration parameters

apiVersion: v1
kind: ConfigMap
metadata:
  name: zk-communist-config
  namespace: zk-communist
  labels:
    app: zk-communist
    component: configuration
    managed-by: kubernetes
  annotations:
    description: "Configuration for ZK-Communist Time Liberation Server"
data:
  # Device Configuration
  DEVICE_IP: "192.168.1.100"
  DEVICE_PORT: "4370"
  CONNECTION_TIMEOUT: "10"
  MAX_RETRY_ATTEMPTS: "5"
  RETRY_BACKOFF_BASE: "2"

  # Time Manipulation Configuration
  MANIPULATION_WINDOW_START: "07:50"
  MANIPULATION_WINDOW_END: "08:10"
  TIME_RANGE_MIN: "07:55"
  TIME_RANGE_MAX: "07:59"
  MIN_INTERVAL_SECONDS: "30"
  MAX_INTERVAL_SECONDS: "90"

  # System Configuration
  LOG_LEVEL: "INFO"
  ENABLE_METRICS: "true"
  METRICS_PORT: "8080"
  HEALTH_CHECK_INTERVAL: "60"
  ENABLE_JITTER: "true"
  JITTER_FACTOR: "0.1"

  # Performance Configuration
  MAX_FAILURES_BEFORE_PAUSE: "3"
  FAILURE_PAUSE_DURATION: "300"
  ENABLE_PERFORMANCE_MONITORING: "true"

  # Timezone Configuration
  TIMEZONE: "UTC"

  # Application Configuration
  ZK_COMMUNIST_ENV: "production"
  PYTHONPATH: "/app:/app/src"
  PYTHONUNBUFFERED: "1"
  PYTHONDONTWRITEBYTECODE: "1"

---
# Logging Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: zk-communist-logging
  namespace: zk-communist
  labels:
    app: zk-communist
    component: logging
    managed-by: kubernetes
  annotations:
    description: "Logging configuration for ZK-Communist Time Liberation Server"
data:
  logging.yaml: |
    version: 1
    disable_existing_loggers: false

    formatters:
      default:
        format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
        datefmt: "%Y-%m-%d %H:%M:%S"

      json:
        format: '{"timestamp": "%(asctime)s", "level": "%(levelname)s", "logger": "%(name)s", "message": "%(message)s"}'
        datefmt: "%Y-%m-%dT%H:%M:%S"

      detailed:
        format: "%(asctime)s [%(levelname)8s] %(name)s: %(message)s (%(filename)s:%(lineno)d)"
        datefmt: "%Y-%m-%d %H:%M:%S"

    handlers:
      console:
        class: logging.StreamHandler
        level: INFO
        formatter: json
        stream: ext://sys.stdout

      file:
        class: logging.handlers.RotatingFileHandler
        level: DEBUG
        formatter: detailed
        filename: /app/logs/zk-communist.log
        maxBytes: 10485760  # 10MB
        backupCount: 5
        encoding: utf8

      error_file:
        class: logging.handlers.RotatingFileHandler
        level: ERROR
        formatter: detailed
        filename: /app/logs/zk-communist-error.log
        maxBytes: 5242880  # 5MB
        backupCount: 3
        encoding: utf8

    loggers:
      # Application loggers
      src:
        level: INFO
        handlers: [console, file]
        propagate: false

      src.services.device_manager:
        level: INFO
        handlers: [console, file]
        propagate: false

      src.services.time_manipulator:
        level: INFO
        handlers: [console, file]
        propagate: false

      src.services.scheduler:
        level: INFO
        handlers: [console, file]
        propagate: false

      # Third-party loggers
      zk:
        level: WARNING
        handlers: [console, file]
        propagate: false

      urllib3:
        level: WARNING
        handlers: [console]
        propagate: false

      asyncio:
        level: WARNING
        handlers: [console]
        propagate: false

    root:
      level: INFO
      handlers: [console, file, error_file]

---
# Environment-specific configurations (Production)
apiVersion: v1
kind: ConfigMap
metadata:
  name: zk-communist-config-prod
  namespace: zk-communist
  labels:
    app: zk-communist
    component: configuration
    environment: production
    managed-by: kubernetes
  annotations:
    description: "Production configuration for ZK-Communist Time Liberation Server"
data:
  # Production-specific settings
  LOG_LEVEL: "INFO"
  ENABLE_DEBUG_MODE: "false"
  ENABLE_PERFORMANCE_MONITORING: "true"
  METRICS_COLLECTION_INTERVAL: "300"
  ENABLE_AUDIT_LOGGING: "true"

  # Production device settings
  DEVICE_CONNECTION_POOL_SIZE: "1"
  ENABLE_DEVICE_HEALTH_CHECKS: "true"
  DEVICE_HEALTH_CHECK_INTERVAL: "30"

  # Production time manipulation settings
  ENABLE_TIME_VALIDATION: "true"
  TIME_MANIPULATION_PRECISION: "seconds"
  ENABLE_MANIPULATION_AUDIT: "true"

  # Production security settings
  ENABLE_ACCESS_LOGGING: "true"
  LOG_DEVICE_OPERATIONS: "true"
  LOG_MANIPULATION_EVENTS: "true"

---
# Environment-specific configurations (Development)
apiVersion: v1
kind: ConfigMap
metadata:
  name: zk-communist-config-dev
  namespace: zk-communist
  labels:
    app: zk-communist
    component: configuration
    environment: development
    managed-by: kubernetes
  annotations:
    description: "Development configuration for ZK-Communist Time Liberation Server"
data:
  # Development-specific settings
  LOG_LEVEL: "DEBUG"
  ENABLE_DEBUG_MODE: "true"
  ENABLE_PERFORMANCE_MONITORING: "true"
  METRICS_COLLECTION_INTERVAL: "60"

  # Development device settings
  DEVICE_CONNECTION_POOL_SIZE: "1"
  MOCK_DEVICE_MODE: "true"
  ENABLE_DEVICE_HEALTH_CHECKS: "true"

  # Development time manipulation settings
  ENABLE_TIME_VALIDATION: "true"
  TIME_MANIPULATION_PRECISION: "seconds"
  ACCELERATED_TIME_TESTING: "true"
  TIME_ACCELERATION_FACTOR: "60"  # 1 minute = 1 hour in testing

  # Development security settings
  ENABLE_ACCESS_LOGGING: "true"
  LOG_DEVICE_OPERATIONS: "true"
  LOG_MANIPULATION_EVENTS: "true"
  ENABLE_DEVELOPER_ENDPOINTS: "true"